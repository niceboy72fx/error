<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Comment use Async/await</title>
</head>
<body>
	<h1>Comment</h1>
	    <ul id="list_comment"></ul>

      <input type="text" placeholder="name" id="name" />
      <br />
      <br />
      <textarea
      name="text"
      id="comment"
      cols="30"
      rows="10"
      placeholder="Type your comment here!!"
      ></textarea>
      <button type="button" id="post">Post</button>
      
      <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
       <script type="module" >
	import axios from "/axios";

	    var api  = "http://localhost:3000/post"; // get API
	    /////////////////////////////////////////////////////////////////////
	    const start = () => {
                 getComment(showComment);
		 handleComment(); 
	    }

	    const getComment = async () => {
		 let db = await axios.get(api);
		 return db
	    }

	    const postComment = async (data) => {
                  try {
			const response = await axios.post(api,data)
		  } catch (err){
                         console.error(err);
		  }
	    }

	    const deleteComment = async (id) => {
                  try {
			const response = await axios.delete(api + "/" + id )
		  } catch(err){
			console.error(err)
		  }
	    }

	   const showComment = (comments) => {
                var comment_block = document.querySelector("#list_comment");
                var htmls = comments.map(function (comment) {
                 return `
		           <li>
			         <h3>${comment.name}<h3>
			         <p>${comment.comment}</p>    
                               <button type="button" onclick="deleteComment(${comment.id})"> &times;  </button>
                          </li>     
		      `;
                });http://127.0.0.1:5500/
                comment_block.innerHTML = htmls.join("");
         };
 
            const handleComment = () => {
		  var button = document.getElementById("post");
                  var name_block = document.getElementById("name");
                  var comment_block = document.getElementById("comment");

                  button.addEventListener("click", function () {
                               var formData = {
                                 name: name_block.value,
                               comment: comment_block.value,
                       };
                              postComment(formData, function () {
                                   getComment(showComment);
                      });
                });
	    }
     console.log(api)
	    start();

       </script>

</body>
</html>